<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda Cultural — Lima | EnLima</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', -apple-system, sans-serif; background-color: #1A1A1D; color: #FFFFFF; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1A1A1D; }
        ::-webkit-scrollbar-thumb { background: #2E2E32; border-radius: 4px; }
        .calendar-day { min-height: 140px; }
        .calendar-day.has-events { background: rgba(111, 66, 193, 0.06); }
        .calendar-day.past { opacity: 0.55; background: #1A1A1D; pointer-events: none; }
        .calendar-day.past .day-num { text-decoration: line-through; color: #666; }
        .event-item:hover { background: rgba(255,255,255,0.06); }
    </style>
</head>
<body class="min-h-screen flex flex-col antialiased selection:bg-[#6F42C1] selection:text-white pb-12">

    <header class="w-full h-14 px-4 md:px-6 flex items-center justify-between border-b border-white/5 bg-[#1A1A1D] sticky top-0 z-50">
        <button class="text-[#A0A0A0] hover:text-white transition-colors focus:outline-none focus:ring-2 focus:ring-[#6F42C1]/45 rounded-sm" aria-label="Menú">
            <i data-lucide="menu" class="w-5 h-5" stroke-width="1.5"></i>
        </button>
        <div class="flex items-center gap-2">
            <div class="w-6 h-6 rounded-full bg-gradient-to-tr from-[#FFC107] to-[#6F42C1] flex items-center justify-center">
                <i data-lucide="sun" class="w-3.5 h-3.5 text-white" stroke-width="2"></i>
            </div>
            <span class="text-base font-semibold tracking-tight text-white">Lima</span>
        </div>
        <div class="w-5 h-5"></div>
    </header>

    <main class="flex-1 w-full max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 pt-10 flex flex-col items-center">
        <h1 class="text-2xl sm:text-3xl lg:text-4xl font-semibold tracking-tight uppercase text-white text-center mb-2">
            Agenda Cultural
        </h1>
        <p class="text-[#A0A0A0] text-sm mb-10 text-center max-w-xl">
            Eventos de <a href="https://enlima.pe/" target="_blank" rel="noopener" class="text-[#8B5CF6] hover:underline">EnLima</a>, <a href="https://www.eventbrite.com.pe/d/peru--miraflores/events/" target="_blank" rel="noopener" class="text-[#8B5CF6] hover:underline">Eventbrite</a> y <a href="https://teleticket.com.pe/todos" target="_blank" rel="noopener" class="text-[#8B5CF6] hover:underline">Teleticket</a> por día
        </p>

        <div id="calendar-container" class="w-full space-y-16">
            <!-- February 2026 -->
            <section class="w-full">
                <h2 class="text-xl sm:text-2xl font-semibold text-white mb-4 flex items-center gap-2">
                    <i data-lucide="calendar-days" class="w-6 h-6 text-[#6F42C1]"></i>
                    Febrero 2026
                </h2>
                <div id="cal-feb-2026" class="rounded-[10px] border border-white/5 bg-[#242428] overflow-hidden shadow-[0_6px_20px_rgba(0,0,0,0.28)]"></div>
            </section>

            <!-- March 2026 -->
            <section class="w-full">
                <h2 class="text-xl sm:text-2xl font-semibold text-white mb-4 flex items-center gap-2">
                    <i data-lucide="calendar-days" class="w-6 h-6 text-[#6F42C1]"></i>
                    Marzo 2026
                </h2>
                <div id="cal-mar-2026" class="rounded-[10px] border border-white/5 bg-[#242428] overflow-hidden shadow-[0_6px_20px_rgba(0,0,0,0.28)]"></div>
            </section>

            <!-- Show more: later months -->
            <section class="w-full" id="more-months-section" style="display: none;">
                <h2 class="text-xl sm:text-2xl font-semibold text-white mb-4 flex items-center gap-2">
                    <i data-lucide="calendar" class="w-6 h-6 text-[#6F42C1]"></i>
                    Próximos meses
                </h2>
                <div class="rounded-[10px] border border-white/5 bg-[#242428] p-8 text-center text-[#A0A0A0]">
                    <p>Abril, Mayo y más meses se pueden añadir ejecutando el scraper para más fechas.</p>
                    <p class="text-sm mt-2">Fuente: <a href="https://enlima.pe/" target="_blank" rel="noopener" class="text-[#8B5CF6] hover:underline">enlima.pe</a></p>
                </div>
            </section>
        </div>

        <div class="mt-12 flex justify-center w-full pb-8">
            <button id="show-more-btn" class="h-10 px-6 bg-[#242428] border border-white/5 hover:border-white/10 hover:bg-[#2A2A2E] rounded-[6px] text-sm font-medium text-[#E0E0E0] hover:text-white transition-all flex items-center gap-2 shadow-[0_4px_12px_rgba(0,0,0,0.22)] hover:-translate-y-px">
                <span>Mostrar más meses</span>
                <i data-lucide="chevron-down" class="w-4 h-4 text-[#A0A0A0]" stroke-width="1.5"></i>
            </button>
        </div>
    </main>

    <script>
        const WEEKDAYS = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
        const MONTHS = ['', 'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];

        function buildMonthCalendar(containerId, year, month, eventsByDay) {
            const container = document.getElementById(containerId);
            if (!container) return;
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month - 1 + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startWeekday = firstDay.getDay();

            let html = '<div class="grid grid-cols-7 border-b border-white/5">';
            WEEKDAYS.forEach(w => {
                html += `<div class="p-2 sm:p-3 text-center text-xs font-medium text-[#A0A0A0] uppercase border-r border-white/5 last:border-r-0">${w}</div>`;
            });
            html += '</div><div class="grid grid-cols-7">';

            let emptyCells = startWeekday;
            while (emptyCells--) {
                html += '<div class="min-h-[120px] sm:min-h-[140px] border-b border-r border-white/5 bg-[#1A1A1D]/50 p-2 sm:p-3"></div>';
            }
            const today = new Date();
            const todayKey = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;
            for (let d = 1; d <= daysInMonth; d++) {
                const dateKey = `${year}-${String(month).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const isExpired = dateKey < todayKey;
                const events = eventsByDay[dateKey] || [];
                const hasEvents = events.length > 0;
                const esc = s => (s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/"/g,'&quot;');
                const pastClass = isExpired ? ' past' : '';
                html += `<div class="calendar-day min-h-[120px] sm:min-h-[140px] border-b border-r border-white/5 p-2 sm:p-3 ${hasEvents ? 'has-events' : ''}${pastClass} bg-[#242428]">`;
                html += `<div class="day-num text-sm font-semibold text-white mb-1">${d}</div>`;
                html += '<div class="space-y-1 overflow-y-auto max-h-[100px] sm:max-h-[120px]">';
                events.slice(0, 6).forEach(ev => {
                    const timeLabel = (ev.time || '').trim() || '—';
                    const link = ev.url ? `<a href="${esc(ev.url)}" target="_blank" rel="noopener" class="event-item block rounded px-1.5 py-0.5 text-[11px] sm:text-xs text-[#E0E0E0] hover:text-[#8B5CF6] truncate" title="${esc(ev.title)}${ev.schedule ? ' — ' + esc(ev.schedule) : ''}">${esc(timeLabel)}</a>` : `<span class="block text-[11px] text-[#A0A0A0]">${esc(timeLabel)}</span>`;
                    html += link;
                });
                if (events.length > 6) html += `<span class="block text-[10px] text-[#6F42C1]">+${events.length - 6} más</span>`;
                html += '</div></div>';
            }
            const totalCells = startWeekday + daysInMonth;
            const endPad = (7 - (totalCells % 7)) % 7;
            for (let i = 0; i < endPad; i++) {
                html += '<div class="min-h-[120px] sm:min-h-[140px] border-b border-r border-white/5 bg-[#1A1A1D]/50 p-2 sm:p-3"></div>';
            }
            html += '</div>';
            container.innerHTML = html;
        }

        let cachedEventsByDay = null;

        function renderCalendars() {
            if (!cachedEventsByDay) return;
            buildMonthCalendar('cal-feb-2026', 2026, 2, cachedEventsByDay);
            buildMonthCalendar('cal-mar-2026', 2026, 3, cachedEventsByDay);
        }

        function init() {
            fetch('events_by_day.json')
                .then(r => r.json())
                .then(eventsByDay => {
                    cachedEventsByDay = eventsByDay;
                    renderCalendars();
                    setInterval(renderCalendars, 60000);
                })
                .catch(() => {
                    document.getElementById('cal-feb-2026').innerHTML = '<div class="p-8 text-center text-[#A0A0A0]">Cargando eventos… Ejecuta <code class="text-[#6F42C1]">python3 enlima_calendar.py</code> y recarga.</div>';
                    document.getElementById('cal-mar-2026').innerHTML = '';
                });

            document.getElementById('show-more-btn').addEventListener('click', function() {
                const section = document.getElementById('more-months-section');
                const icon = this.querySelector('i');
                if (section.style.display === 'none') {
                    section.style.display = 'block';
                    if (typeof lucide !== 'undefined' && icon) icon.setAttribute('data-lucide', 'chevron-up');
                } else {
                    section.style.display = 'none';
                    if (typeof lucide !== 'undefined' && icon) icon.setAttribute('data-lucide', 'chevron-down');
                }
                if (typeof lucide !== 'undefined') lucide.createIcons();
            });

            if (typeof lucide !== 'undefined') lucide.createIcons();
        }
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
