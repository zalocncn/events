<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Que hacemos — Eventos en Lima</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
    <style>
        body { font-family: 'Inter', -apple-system, sans-serif; background-color: #1A1A1D; color: #FFFFFF; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1A1A1D; }
        ::-webkit-scrollbar-thumb { background: #2E2E32; border-radius: 4px; }
        .calendar-day { min-height: 72px; }
        @media (min-width: 640px) { .calendar-day { min-height: 100px; } }
        @media (min-width: 768px) { .calendar-day { min-height: 120px; } }
        @media (min-width: 1024px) { .calendar-day { min-height: 140px; } }
        .calendar-day.has-events { background: rgba(111, 66, 193, 0.06); }
        .calendar-day.past { opacity: 0.55; background: #1A1A1D; pointer-events: none; }
        .calendar-day.past .day-num { text-decoration: line-through; color: #666; }
        .event-item:hover { background: rgba(255,255,255,0.06); }
        #calendar-container .cal-grid-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        @media (min-width: 640px) { #calendar-container .cal-grid-wrapper { overflow-x: visible; } }
        #event-preview { z-index: 1000; pointer-events: none; }
        #event-preview.visible { pointer-events: auto; }
        .accordion-panel { max-height: 0; overflow: hidden; transition: max-height 0.25s ease-out; }
        .accordion-day.is-open .accordion-panel { max-height: 2000px; transition: max-height 0.35s ease-in; }
        .accordion-day.is-open .accordion-chevron { transform: rotate(180deg); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="min-h-screen flex flex-col antialiased selection:bg-[#6F42C1] selection:text-white pb-12">

    <header class="w-full h-14 px-4 md:px-6 flex items-center justify-between border-b border-white/5 bg-[#1A1A1D] sticky top-0 z-50">
        <div class="w-5 h-5"></div>
        <div class="flex items-center gap-2">
            <div class="w-6 h-6 rounded-full bg-gradient-to-tr from-[#FFC107] to-[#6F42C1] flex items-center justify-center">
                <i data-lucide="sun" class="w-3.5 h-3.5 text-white" stroke-width="2"></i>
            </div>
            <span class="text-base font-semibold tracking-tight text-white">Lima</span>
        </div>
        <div class="w-5 h-5"></div>
    </header>

    <main class="flex-1 w-full max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 pt-10 flex flex-col items-center">
        <h1 class="text-2xl sm:text-3xl lg:text-4xl font-semibold tracking-tight text-white text-center mb-1">
            Que hacemos
        </h1>
        <p class="text-[#A0A0A0] text-sm sm:text-base font-medium text-center mb-2">
            Eventos en Lima
        </p>
        <p class="text-[#888] text-xs sm:text-sm mb-10 text-center max-w-xl">
            De <a href="https://enlima.pe/" target="_blank" rel="noopener" class="text-[#8B5CF6] hover:underline">EnLima</a>, <a href="https://www.eventbrite.com.pe/d/peru--miraflores/events/" target="_blank" rel="noopener" class="text-[#8B5CF6] hover:underline">Eventbrite</a> y <a href="https://teleticket.com.pe/todos" target="_blank" rel="noopener" class="text-[#8B5CF6] hover:underline">Teleticket</a>
        </p>

        <div id="calendar-container" class="w-full space-y-8 sm:space-y-12 lg:space-y-16">
            <!-- Desktop: grid calendar (md and up) -->
            <div id="calendar-grid-view" class="hidden md:block space-y-8 sm:space-y-12 lg:space-y-16">
            <section class="w-full">
                <h2 class="text-lg sm:text-xl md:text-2xl font-semibold text-white mb-3 sm:mb-4 flex items-center gap-2">
                    <i data-lucide="calendar-days" class="w-5 h-5 sm:w-6 sm:h-6 text-[#6F42C1]"></i>
                    Febrero 2026
                </h2>
                <div id="cal-feb-2026" class="rounded-lg sm:rounded-[10px] border border-white/5 bg-[#242428] overflow-hidden shadow-[0_4px_12px_rgba(0,0,0,0.2)] sm:shadow-[0_6px_20px_rgba(0,0,0,0.28)]"></div>
            </section>

            <section class="w-full">
                <h2 class="text-lg sm:text-xl md:text-2xl font-semibold text-white mb-3 sm:mb-4 flex items-center gap-2">
                    <i data-lucide="calendar-days" class="w-5 h-5 sm:w-6 sm:h-6 text-[#6F42C1]"></i>
                    Marzo 2026
                </h2>
                <div id="cal-mar-2026" class="rounded-lg sm:rounded-[10px] border border-white/5 bg-[#242428] overflow-hidden shadow-[0_4px_12px_rgba(0,0,0,0.2)] sm:shadow-[0_6px_20px_rgba(0,0,0,0.28)]"></div>
            </section>
            </div>

            <!-- Mobile: Schedule Dashboard (date scroller + event cards) -->
            <div id="calendar-mobile-dashboard" class="md:hidden w-full max-w-full min-h-[480px] bg-[#1A1A1D] rounded-[20px] shadow-[0_12px_40px_rgba(0,0,0,0.35)] border border-[rgba(255,255,255,0.05)] overflow-hidden flex flex-col relative">
                <div class="p-4 sm:p-5 pb-0">
                    <div class="mb-4 sm:mb-5">
                        <p class="text-sm font-light text-[#C0C0C0] mb-1">Hoy</p>
                        <h1 id="mobile-dash-date" class="text-xl font-semibold tracking-tight text-[#FFFFFF]">—</h1>
                    </div>
                    <div class="flex items-center justify-center gap-4 mb-4 sm:mb-5">
                        <button type="button" id="mobile-dash-prev" class="p-2 hover:bg-[#2A2A2E] rounded-full transition-colors duration-200 group active:scale-95" aria-label="Mes anterior">
                            <i data-lucide="arrow-left" class="w-5 h-5 text-[#A0A0A0] group-hover:text-[#6F42C1]" stroke-width="1.5"></i>
                        </button>
                        <h2 id="mobile-dash-month" class="text-lg font-medium tracking-tight text-[#FFFFFF] min-w-[140px] text-center">—</h2>
                        <button type="button" id="mobile-dash-next" class="p-2 hover:bg-[#2A2A2E] rounded-full transition-colors duration-200 group active:scale-95" aria-label="Mes siguiente">
                            <i data-lucide="arrow-right" class="w-5 h-5 text-[#A0A0A0] group-hover:text-[#6F42C1]" stroke-width="1.5"></i>
                        </button>
                    </div>
                    <div id="mobile-dash-scroller" class="grid grid-flow-col gap-2 pb-4 hide-scrollbar overflow-x-auto snap-x snap-mandatory w-max min-w-full" style="grid-auto-columns: minmax(48px, 64px);"></div>
                    <div class="w-10 h-1 bg-[rgba(255,255,255,0.06)] rounded-full mx-auto mb-4 sm:mb-5"></div>
                </div>
                <div id="mobile-dash-events" class="px-4 sm:px-5 pb-10 grid grid-cols-1 min-[360px]:grid-cols-2 gap-3 sm:gap-4 flex-grow overflow-y-auto content-start"></div>
                <div class="absolute bottom-0 left-0 right-0 h-10 bg-gradient-to-t from-[#1A1A1D] to-transparent pointer-events-none"></div>
            </div>

            <!-- Show more: later months (Apr–Dec 2026 loaded on click) -->
            <section class="w-full" id="more-months-section" style="display: none;">
                <div id="more-months-container" class="space-y-8 sm:space-y-12 lg:space-y-16"></div>
            </section>
        </div>

        <div class="mt-8 sm:mt-12 flex justify-center w-full pb-8">
            <button id="show-more-btn" class="h-10 px-6 bg-[#242428] border border-white/5 hover:border-white/10 hover:bg-[#2A2A2E] rounded-[6px] text-sm font-medium text-[#E0E0E0] hover:text-white transition-all flex items-center gap-2 shadow-[0_4px_12px_rgba(0,0,0,0.22)] hover:-translate-y-px">
                <span>Mostrar más meses</span>
                <i data-lucide="chevron-down" class="w-4 h-4 text-[#A0A0A0]" stroke-width="1.5"></i>
            </button>
        </div>

        <footer class="w-full border-t border-white/5 mt-8 sm:mt-12 pt-6 pb-8 flex justify-center">
            <a href="blog.html" class="text-sm text-[#A0A0A0] hover:text-[#8B5CF6] transition-colors flex items-center gap-1.5">
                <i data-lucide="file-text" class="w-4 h-4" stroke-width="1.5"></i>
                Blog
            </a>
        </footer>
    </main>

    <!-- Event hover preview popover -->
    <div id="event-preview" class="fixed hidden opacity-0 transition-opacity duration-150 w-[min(320px,calc(100vw-24px))] rounded-xl border border-white/10 bg-[#242428] shadow-[0_12px_40px_rgba(0,0,0,0.5)] overflow-hidden" aria-hidden="true">
        <div class="aspect-video bg-[#2A2A2E] bg-cover bg-center" id="event-preview-image"></div>
        <div class="p-3 sm:p-4 space-y-2">
            <p class="text-[10px] sm:text-xs font-medium uppercase tracking-wide text-[#6F42C1]" id="event-preview-type"></p>
            <h3 class="text-sm sm:text-base font-semibold text-white line-clamp-2 leading-snug" id="event-preview-title"></h3>
            <div class="flex flex-wrap gap-x-3 gap-y-1 text-xs text-[#A0A0A0]">
                <span class="flex items-center gap-1" id="event-preview-time"></span>
                <span class="flex items-center gap-1" id="event-preview-venue"></span>
            </div>
            <p class="text-xs text-[#C0C0C0]" id="event-preview-price"></p>
            <p class="text-[11px] text-[#888]" id="event-preview-schedule"></p>
            <a id="event-preview-link" href="#" target="_blank" rel="noopener" class="mt-2 inline-flex items-center gap-1.5 text-xs font-medium text-[#8B5CF6] hover:text-[#A78BFA]">
                Ver evento <i data-lucide="external-link" class="w-3.5 h-3.5" stroke-width="1.5"></i>
            </a>
        </div>
    </div>

    <script>
        const WEEKDAYS = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
        const MONTHS = ['', 'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];

        function limaFix(s) {
            if (typeof s !== 'string') return s;
            return s.replace(/\bLime\b/g, 'Lima');
        }

        function toAmPm(timeStr) {
            if (!timeStr || typeof timeStr !== 'string') return '';
            const t = timeStr.trim();
            if (!t) return '';
            const m = t.match(/^(\d{1,2}):(\d{2})\s*([ap]\.?m\.?)?$/i);
            if (!m) return t;
            let h = parseInt(m[1], 10);
            const min = m[2];
            const ampm = (m[3] || '').toLowerCase().replace('.', '');
            if (ampm === 'am' || ampm === 'pm') return t;
            if (h === 0) return `12:${min} am`;
            if (h < 12) return `${h}:${min} am`;
            if (h === 12) return `12:${min} pm`;
            return `${h - 12}:${min} pm`;
        }

        function buildMonthCalendar(containerId, year, month, eventsByDay) {
            const container = document.getElementById(containerId);
            if (!container) return;
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month - 1 + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startWeekday = firstDay.getDay();

            const esc = s => (s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/"/g,'&quot;');
            const escAttr = s => esc(s).replace(/'/g, '&#39;');
            const minDay = 'min-h-[72px] sm:min-h-[100px] md:min-h-[120px] lg:min-h-[140px]';

            let html = '<div class="cal-grid-wrapper min-w-0"><div class="grid grid-cols-7 border-b border-white/5 min-w-[280px]">';
            WEEKDAYS.forEach(w => {
                html += `<div class="p-1.5 sm:p-2 md:p-3 text-center text-[10px] sm:text-xs font-medium text-[#A0A0A0] uppercase border-r border-white/5 last:border-r-0">${w}</div>`;
            });
            html += `</div><div class="grid grid-cols-7 min-w-[280px]">`;

            let emptyCells = startWeekday;
            while (emptyCells--) {
                html += `<div class="calendar-day ${minDay} border-b border-r border-white/5 bg-[#1A1A1D]/50 p-1.5 sm:p-2 md:p-3"></div>`;
            }
            const today = new Date();
            const todayKey = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;
            for (let d = 1; d <= daysInMonth; d++) {
                const dateKey = `${year}-${String(month).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const isExpired = dateKey < todayKey;
                const events = eventsByDay[dateKey] || [];
                const hasEvents = events.length > 0;
                const pastClass = isExpired ? ' past' : '';
                html += `<div class="calendar-day ${minDay} border-b border-r border-white/5 p-1.5 sm:p-2 md:p-3 ${hasEvents ? 'has-events' : ''}${pastClass} bg-[#242428]">`;
                html += `<div class="day-num text-xs sm:text-sm font-semibold text-white mb-0.5 sm:mb-1">${d}</div>`;
                html += '<div class="flex flex-wrap gap-1 items-center max-h-[60px] sm:max-h-[80px] md:max-h-[100px] lg:max-h-[120px] overflow-y-auto">';
                events.forEach(ev => {
                    const timeLabel = toAmPm(ev.time) || '—';
                    const dataEvent = escAttr(JSON.stringify(ev));
                    const tooltip = esc(limaFix(ev.title)) + (ev.schedule ? ' — ' + esc(limaFix(ev.schedule)) : '') + (timeLabel !== '—' ? ' · ' + timeLabel : '');
                    if (ev.url) {
                        html += `<a href="${esc(ev.url)}" target="_blank" rel="noopener" class="event-item event-dot w-2 h-2 sm:w-2.5 sm:h-2.5 rounded-full bg-[#6F42C1] hover:bg-[#8B5CF6] hover:scale-125 transition-all cursor-pointer shrink-0 inline-block" title="${tooltip}" data-event="${dataEvent}" aria-label="${esc(limaFix(ev.title))}"></a>`;
                    } else {
                        html += `<span class="event-item event-dot w-2 h-2 sm:w-2.5 sm:h-2.5 rounded-full bg-[#A0A0A0] hover:bg-[#B0B0B0] hover:scale-125 transition-all cursor-pointer shrink-0 inline-block" title="${tooltip}" data-event="${dataEvent}" aria-label="${esc(limaFix(ev.title))}" role="button" tabindex="0"></span>`;
                    }
                });
                html += '</div></div>';
            }
            const totalCells = startWeekday + daysInMonth;
            const endPad = (7 - (totalCells % 7)) % 7;
            for (let i = 0; i < endPad; i++) {
                html += `<div class="calendar-day ${minDay} border-b border-r border-white/5 bg-[#1A1A1D]/50 p-1.5 sm:p-2 md:p-3"></div>`;
            }
            html += '</div></div>';
            container.innerHTML = html;
            attachEventPreviewListeners(container);
        }

        const PLACEHOLDER_IMG = 'https://images.unsplash.com/photo-1492684223066-81342ee5ff30?q=80&w=600&auto=format&fit=crop';

        let mobileDashState = { year: 2026, month: 2, selectedDateKey: null };

        function getTodayKey() {
            const t = new Date();
            return `${t.getFullYear()}-${String(t.getMonth() + 1).padStart(2,'0')}-${String(t.getDate()).padStart(2,'0')}`;
        }

        function buildMobileDashboard(eventsByDay) {
            const todayKey = getTodayKey();
            if (!mobileDashState.selectedDateKey || mobileDashState.selectedDateKey < todayKey)
                mobileDashState.selectedDateKey = todayKey;
            const [y, m] = [mobileDashState.year, mobileDashState.month];
            const monthName = MONTHS[m];
            document.getElementById('mobile-dash-month').textContent = `${monthName} ${y}`;
            const selectedKey = mobileDashState.selectedDateKey;
            const selDate = selectedKey ? new Date(selectedKey + 'T12:00:00') : null;
            document.getElementById('mobile-dash-date').textContent = selDate
                ? `${selDate.getDate()} ${monthName}, ${WEEKDAYS[selDate.getDay()]}`
                : '—';

            const lastDay = new Date(y, m, 0);
            const daysInMonth = lastDay.getDate();
            const esc = s => (s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/"/g,'&quot;');
            let scrollerHtml = '';
            for (let d = 1; d <= daysInMonth; d++) {
                const dateKey = `${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                if (dateKey < todayKey) continue;
                const events = eventsByDay[dateKey] || [];
                const weekday = new Date(y, m - 1, d).getDay();
                const wd = WEEKDAYS[weekday];
                const isActive = dateKey === selectedKey;
                const pillClass = isActive
                    ? 'snap-start min-w-0 w-full py-2.5 sm:py-3 rounded-[10px] bg-[#6F42C1] shadow-[0_0_18px_rgba(111,66,193,0.28)] flex flex-col items-center justify-center gap-0.5 border border-[rgba(111,66,193,0.35)]'
                    : 'snap-start min-w-0 w-full py-2.5 sm:py-3 rounded-[10px] border border-[rgba(255,255,255,0.04)] bg-[#242428] flex flex-col items-center justify-center gap-0.5 hover:-translate-y-0.5 active:scale-95';
                scrollerHtml += `<button type="button" class="${pillClass} mobile-date-pill" data-date="${dateKey}">`;
                scrollerHtml += `<span class="text-xs font-light ${isActive ? 'text-[#E0E0E0]' : 'text-[#C0C0C0]'}">${wd}</span>`;
                scrollerHtml += `<span class="text-base font-medium ${isActive ? 'text-[#FFFFFF] font-semibold' : 'text-[#E0E0E0]'}">${d}</span>`;
                if (events.length > 0) {
                    scrollerHtml += '<div class="flex gap-0.5 mt-0.5">';
                    events.slice(0, 3).forEach(() => { scrollerHtml += '<div class="w-1 h-1 rounded-full ' + (isActive ? 'bg-[#FFFFFF]' : 'bg-[#6F42C1]') + '"></div>'; });
                    scrollerHtml += '</div>';
                }
                scrollerHtml += '</button>';
            }
            const scrollerEl = document.getElementById('mobile-dash-scroller');
            if (scrollerEl) scrollerEl.innerHTML = scrollerHtml;

            scrollerEl.querySelectorAll('.mobile-date-pill').forEach(btn => {
                btn.addEventListener('click', function() {
                    mobileDashState.selectedDateKey = this.getAttribute('data-date');
                    buildMobileDashboard(cachedEventsByDay);
                });
            });

            const events = eventsByDay[selectedKey] || [];
            const eventsEl = document.getElementById('mobile-dash-events');
            if (!eventsEl) return;
            if (events.length === 0) {
                eventsEl.innerHTML = '<p class="text-[#666] text-sm py-4 text-center">Sin eventos este día.</p>';
            } else {
                const accentBySource = { Teleticket: '#3B82F6', Eventbrite: '#FFC107', EnLima: '#5CB85C' };
                eventsEl.innerHTML = events.map((ev, i) => {
                    const isFocal = i === 0;
                    const typeLabel = ev.type || ev.source || '';
                    const accent = accentBySource[ev.source] || '#6F42C1';
                    const timeLabel = toAmPm(ev.time) || '—';
                    const venueText = limaFix([ev.venue, ev.district].filter(Boolean).join(', ') || 'Lima');
                    const link = ev.url || '#';
                    const title = esc(limaFix(ev.title || 'Evento'));
                    const schedule = ev.schedule ? esc(limaFix(ev.schedule)) : '';
                    const price = (ev.price || '').trim() ? esc(ev.price) : '';
                    if (isFocal) {
                        return `<a href="${link}" target="_blank" rel="noopener" class="block transition-all duration-200 hover:-translate-y-0.5 hover:shadow-[0_12px_40px_rgba(0,0,0,0.4)] bg-[#242428] rounded-[14px] p-5 shadow-[0_6px_20px_rgba(0,0,0,0.28)] border border-[rgba(255,255,255,0.06)] no-underline">
                            <div class="flex flex-wrap items-center gap-x-2 gap-y-1 mb-3 text-sm">
                                <span class="font-medium text-[#6F42C1]">${esc(typeLabel)}</span>
                                <span class="w-px h-3 bg-white/20 shrink-0"></span>
                                <span class="font-medium text-[#E0E0E0]">${esc(timeLabel)}</span>
                                <span class="w-px h-3 bg-white/20 shrink-0"></span>
                                <span class="text-[#A0A0A0]">${esc(venueText)}</span>
                            </div>
                            <h3 class="text-lg font-semibold tracking-tight text-[#FFFFFF] mb-4 leading-snug line-clamp-2">${title}</h3>
                            <div class="space-y-3">
                                <div class="flex items-center gap-3 text-sm text-[#C0C0C0]"><div class="w-7 h-7 rounded-md bg-[rgba(111,66,193,0.15)] flex items-center justify-center shrink-0"><i data-lucide="clock" class="w-4 h-4 text-[#6F42C1]" stroke-width="1.5"></i></div><span>${esc(timeLabel)}</span></div>
                                <div class="flex items-center gap-3 text-sm text-[#C0C0C0]"><div class="w-7 h-7 rounded-md bg-[rgba(111,66,193,0.15)] flex items-center justify-center shrink-0"><i data-lucide="map-pin" class="w-4 h-4 text-[#6F42C1]" stroke-width="1.5"></i></div><span>${esc(venueText)}</span></div>
                                ${price ? `<p class="text-sm text-[#A0A0A0]">${price}</p>` : ''}
                            </div>
                        </a>`;
                    }
                    return `<a href="${link}" target="_blank" rel="noopener" class="block transition-all duration-200 hover:-translate-y-0.5 hover:shadow-[0_12px_40px_rgba(0,0,0,0.4)] bg-[#242428] rounded-[14px] p-5 shadow-[0_6px_20px_rgba(0,0,0,0.28)] border border-[rgba(255,255,255,0.06)] no-underline">
                            <div class="flex flex-wrap items-center gap-x-2 gap-y-1 mb-3 text-sm">
                                <span class="font-medium" style="color:${accent}">${esc(typeLabel)}</span>
                                <span class="w-px h-3 bg-white/20 shrink-0"></span>
                                <span class="font-medium text-[#E0E0E0]">${esc(timeLabel)}</span>
                                <span class="w-px h-3 bg-white/20 shrink-0"></span>
                                <span class="text-[#A0A0A0]">${esc(venueText)}</span>
                            </div>
                            <h3 class="text-lg font-semibold tracking-tight text-[#FFFFFF] mb-4 leading-snug line-clamp-2">${title}</h3>
                            <div class="space-y-3">
                                <div class="flex items-center gap-3 text-sm text-[#C0C0C0]"><div class="w-7 h-7 rounded-md flex items-center justify-center shrink-0" style="background:rgba(111,66,193,0.15)"><i data-lucide="clock" class="w-4 h-4 text-[#6F42C1]" stroke-width="1.5"></i></div><span>${esc(timeLabel)}</span></div>
                                <div class="flex items-center gap-3 text-sm text-[#C0C0C0]"><div class="w-7 h-7 rounded-md flex items-center justify-center shrink-0" style="background:rgba(111,66,193,0.15)"><i data-lucide="map-pin" class="w-4 h-4 text-[#6F42C1]" stroke-width="1.5"></i></div><span>${esc(venueText)}</span></div>
                                ${schedule ? `<div class="flex items-center gap-3 text-sm text-[#C0C0C0]"><div class="w-7 h-7 rounded-md flex items-center justify-center shrink-0" style="background:rgba(111,66,193,0.15)"><i data-lucide="calendar" class="w-4 h-4 text-[#6F42C1]" stroke-width="1.5"></i></div><span>${schedule}</span></div>` : ''}
                                ${price ? `<p class="text-sm text-[#A0A0A0]">${price}</p>` : ''}
                            </div>
                        </a>`;
                }).join('');
            }
            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        function initMobileDashboard(eventsByDay) {
            const todayKey = getTodayKey();
            const [y, m] = [todayKey.split('-')[0], todayKey.split('-')[1]];
            mobileDashState = { year: parseInt(y, 10), month: parseInt(m, 10), selectedDateKey: todayKey };
            buildMobileDashboard(eventsByDay);

            document.getElementById('mobile-dash-prev').onclick = function() {
                if (mobileDashState.year === 2026 && mobileDashState.month <= 2) return;
                mobileDashState.month--;
                if (mobileDashState.month < 1) { mobileDashState.month = 12; mobileDashState.year--; }
                const lastDay = new Date(mobileDashState.year, mobileDashState.month, 0).getDate();
                const d = mobileDashState.selectedDateKey ? Math.min(parseInt(mobileDashState.selectedDateKey.split('-')[2], 10), lastDay) : 1;
                mobileDashState.selectedDateKey = `${mobileDashState.year}-${String(mobileDashState.month).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                buildMobileDashboard(cachedEventsByDay);
            };
            document.getElementById('mobile-dash-next').onclick = function() {
                if (mobileDashState.year === 2026 && mobileDashState.month >= 3) return;
                mobileDashState.month++;
                if (mobileDashState.month > 12) { mobileDashState.month = 1; mobileDashState.year++; }
                mobileDashState.selectedDateKey = `${mobileDashState.year}-${String(mobileDashState.month).padStart(2,'0')}-01`;
                buildMobileDashboard(cachedEventsByDay);
            };
        }

        let previewHideTimer = null;

        function showEventPreview(ev, anchor) {
            const pop = document.getElementById('event-preview');
            if (!pop) return;
            const rect = anchor.getBoundingClientRect();
            const imgEl = document.getElementById('event-preview-image');
            const typeEl = document.getElementById('event-preview-type');
            const titleEl = document.getElementById('event-preview-title');
            const timeEl = document.getElementById('event-preview-time');
            const venueEl = document.getElementById('event-preview-venue');
            const priceEl = document.getElementById('event-preview-price');
            const scheduleEl = document.getElementById('event-preview-schedule');
            const linkEl = document.getElementById('event-preview-link');

            typeEl.textContent = ev.type || ev.source || '';
            titleEl.textContent = limaFix(ev.title || 'Evento');
            timeEl.textContent = toAmPm(ev.time) || '—';
            timeEl.style.display = '';
            const venueText = limaFix([ev.venue, ev.district].filter(Boolean).join(', ') || '—');
            venueEl.textContent = venueText;
            venueEl.style.display = venueText !== '—' ? '' : 'none';
            priceEl.textContent = (ev.price || '').trim() ? 'Precio: ' + (ev.price || '').trim() : '';
            priceEl.style.display = priceEl.textContent ? '' : 'none';
            scheduleEl.textContent = limaFix(ev.schedule || '');
            scheduleEl.style.display = scheduleEl.textContent ? '' : 'none';
            linkEl.href = ev.url || '#';

            const imgUrl = ev.image_url || 'https://images.unsplash.com/photo-1492684223066-81342ee5ff30?q=80&w=600&auto=format&fit=crop';
            imgEl.style.backgroundImage = `url(${imgUrl})`;

            pop.classList.remove('hidden');
            pop.style.left = '-9999px';
            pop.style.top = '0';
            pop.classList.add('visible');
            pop.style.opacity = '1';

            requestAnimationFrame(() => {
                const pad = 12;
                const w = pop.offsetWidth || 320;
                const h = pop.offsetHeight || 200;
                let left = rect.left + (rect.width / 2) - (w / 2);
                let top = rect.bottom + pad;
                if (top + h > window.innerHeight - pad) top = rect.top - h - pad;
                if (left < pad) left = pad;
                if (left + w > window.innerWidth - pad) left = window.innerWidth - w - pad;
                pop.style.left = left + 'px';
                pop.style.top = top + 'px';
                if (typeof lucide !== 'undefined') lucide.createIcons();
            });
        }

        function hideEventPreview() {
            const pop = document.getElementById('event-preview');
            if (!pop) return;
            pop.classList.remove('visible');
            pop.style.opacity = '0';
            setTimeout(() => pop.classList.add('hidden'), 150);
        }

        function attachEventPreviewListeners(container) {
            if (!container) return;
            container.querySelectorAll('.event-item[data-event]').forEach(a => {
                a.addEventListener('mouseenter', function() {
                    if (previewHideTimer) clearTimeout(previewHideTimer);
                    previewHideTimer = null;
                    try {
                        const ev = JSON.parse(this.getAttribute('data-event') || '{}');
                        showEventPreview(ev, this);
                    } catch (_) {}
                });
                a.addEventListener('mouseleave', function() {
                    previewHideTimer = setTimeout(hideEventPreview, 120);
                });
            });
            const pop = document.getElementById('event-preview');
            if (pop) {
                pop.addEventListener('mouseenter', () => { if (previewHideTimer) clearTimeout(previewHideTimer); previewHideTimer = null; });
                pop.addEventListener('mouseleave', () => { previewHideTimer = setTimeout(hideEventPreview, 120); });
            }
        }

        let cachedEventsByDay = null;

        function renderCalendars() {
            if (!cachedEventsByDay) return;
            buildMonthCalendar('cal-feb-2026', 2026, 2, cachedEventsByDay);
            buildMonthCalendar('cal-mar-2026', 2026, 3, cachedEventsByDay);
            buildMobileDashboard(cachedEventsByDay);
        }

        function init() {
            fetch('events_by_day.json')
                .then(r => r.json())
                .then(eventsByDay => {
                    cachedEventsByDay = eventsByDay;
                    renderCalendars();
                    initMobileDashboard(eventsByDay);
                    setInterval(renderCalendars, 60000);
                })
                .catch(() => {
                    const msg = '<div class="p-8 text-center text-[#A0A0A0]">Cargando eventos… Ejecuta <code class="text-[#6F42C1]">python3 enlima_calendar.py</code> y recarga.</div>';
                    const calFeb = document.getElementById('cal-feb-2026');
                    const calMar = document.getElementById('cal-mar-2026');
                    const dash = document.getElementById('calendar-mobile-dashboard');
                    if (calFeb) calFeb.innerHTML = msg;
                    if (calMar) calMar.innerHTML = '';
                    if (dash) dash.innerHTML = '<div class="p-8 text-center text-[#A0A0A0]">' + msg + '</div>';
                });

            document.getElementById('show-more-btn').addEventListener('click', function() {
                const section = document.getElementById('more-months-section');
                const container = document.getElementById('more-months-container');
                const icon = this.querySelector('i');
                if (section.style.display === 'none') {
                    section.style.display = 'block';
                    if (typeof lucide !== 'undefined' && icon) icon.setAttribute('data-lucide', 'chevron-up');
                    // Load Apr–Dec 2026 on first expand
                    if (container && container.children.length === 0 && cachedEventsByDay) {
                        for (let month = 4; month <= 12; month++) {
                            const monthName = MONTHS[month];
                            const sectionEl = document.createElement('section');
                            sectionEl.className = 'w-full';
                            sectionEl.innerHTML = '<h2 class="text-lg sm:text-xl md:text-2xl font-semibold text-white mb-3 sm:mb-4 flex items-center gap-2"><i data-lucide="calendar-days" class="w-5 h-5 sm:w-6 sm:h-6 text-[#6F42C1]"></i>' + monthName + ' 2026</h2><div id="cal-' + month + '-2026" class="rounded-lg sm:rounded-[10px] border border-white/5 bg-[#242428] overflow-hidden shadow-[0_4px_12px_rgba(0,0,0,0.2)] sm:shadow-[0_6px_20px_rgba(0,0,0,0.28)]"></div>';
                            container.appendChild(sectionEl);
                            buildMonthCalendar('cal-' + month + '-2026', 2026, month, cachedEventsByDay);
                        }
                        if (typeof lucide !== 'undefined') lucide.createIcons();
                    }
                } else {
                    section.style.display = 'none';
                    if (typeof lucide !== 'undefined' && icon) icon.setAttribute('data-lucide', 'chevron-down');
                }
                if (typeof lucide !== 'undefined') lucide.createIcons();
            });

            if (typeof lucide !== 'undefined') lucide.createIcons();
        }
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
